rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // ========== PUBLIC READ: Workouts Collection (No Login Required) ==========
    // Anyone can read the shared workouts catalog
    match /workouts/{workoutId} {
      allow read: if true;
      allow write: if false; // Prevent clients from modifying workouts
    }
    
    // ========== USER-SPECIFIC DATA: Must be authenticated ==========
    // User documents and their sub-collections
    match /users/{userId} {
      // Allow users to read/write their own profile
      allow read, write: if request.auth.uid == userId;
      
      // Completed workouts
      match /completedWorkouts/{workoutId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      // Favorite workouts
      match /favorites/{workoutId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      // User's personal workouts
      match /workouts/{workoutId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      // Running routes
      match /runs/{runId} {
        allow read, write: if request.auth.uid == userId;
      }
      
      // User settings (goals, preferences, etc.)
      match /settings/{document=**} {
        allow read, write: if request.auth.uid == userId;
      }
    }
    
    // ========== DEFAULT: Deny all other access ==========
    // Anything not explicitly allowed above is denied
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
